
# Go Pet Backend ‚Äî HTTP + gRPC MVP

–£—á–µ–±–Ω—ã–π backend-–ø—Ä–æ–µ–∫—Ç –Ω–∞ Go, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–∞–∫ **—Ä–∞–±–æ—á–∏–π MVP** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π HTTP –∏ gRPC, PostgreSQL, Docker –∏ JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

–ü—Ä–æ–µ–∫—Ç —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω –Ω–∞ **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–º –º—ã—à–ª–µ–Ω–∏–∏, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ —Å context**, –∞ –Ω–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π.

---

## üéØ –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **—á–∏—Å—Ç—É—é —Å–ª–æ–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**
- –ü–æ–Ω—è—Ç—å –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å **HTTP –∏ gRPC**
- –û—Å–æ–∑–Ω–∞–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
  - `context.Context`
  - deadlines / timeouts
  - metadata
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ context**
- –ü–æ–∫—Ä—ã—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É **unit-—Ç–µ—Å—Ç–∞–º–∏ –±–µ–∑ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
- –ü–æ–ª—É—á–∏—Ç—å **—á–∏—Å—Ç—ã–π, –æ–±—ä—è—Å–Ω–∏–º—ã–π MVP**

---

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—É—é –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω—É—é **—Ç—Ä—ë—Ö—Å–ª–æ–π–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**:

Transport (HTTP / gRPC)
‚Üì
Service (business logic)
‚Üì
Repository (PostgreSQL)

---

## 1Ô∏è‚É£ Transport layer

Transport —Å–ª–æ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω:
- HTTP (REST) ‚Äî `chi`
- gRPC ‚Äî `grpc-go`

### –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å transport —Å–ª–æ—è
- –ø–∞—Ä—Å–∏–Ω–≥ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ `userID` –∏–∑ `context.Context`
- —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É

### –í–∞–∂–Ω–æ
Transport —Å–ª–æ–π **–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏** –∏ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π.

---

## 2Ô∏è‚É£ Service layer (–∫–ª—é—á–µ–≤–æ–π —Å–ª–æ–π)

Service —Å–ª–æ–π:
- –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- –Ω–µ –∑–Ω–∞–µ—Ç:
  - –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª –∑–∞–ø—Ä–æ—Å (HTTP / gRPC)
  - –∫–∞–∫–∞—è –ë–î –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  - —Ä–µ–∞–ª—å–Ω–∞—è –ª–∏ —ç—Ç–æ –ë–î –∏–ª–∏ mock
- —É–ø—Ä–∞–≤–ª—è–µ—Ç –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ –∏ side-effect‚Äô–∞–º–∏

### –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–µ—Ä–≤–∏—Å–∞

```go
type Service struct {
	repo TodoRepository
	echo EchoClient
}

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:

todoService := todoservice.New(todoRepo, echoClient)

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
	‚Ä¢	–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
	‚Ä¢	–ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å transport —Å–ª–æ–π
	‚Ä¢	–∑–∞–º–µ–Ω—è—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞

‚∏ª

3Ô∏è‚É£ Repository layer

Repository —Å–ª–æ–π:
	‚Ä¢	—Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å–æ–º
	‚Ä¢	—Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç—É —Å PostgreSQL
	‚Ä¢	–Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
	‚Ä¢	–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ service —Å–ª–æ—è

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

type TodoRepository interface {
	CreateTodo(...)
	GetTodosByUser(...)
	UpdateTodoCompleted(...)
	DeleteTodo(...)
}


‚∏ª

üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ Context

JWT ‚Üí Context (–∫–ª—é—á–µ–≤–∞—è –∏–¥–µ—è)
	1.	JWT –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–ª–∏–µ–Ω—Ç–æ–º:
	‚Ä¢	HTTP: Authorization: Bearer <token>
	‚Ä¢	gRPC: metadata authorization
	2.	–ù–∞ gRPC-–≥—Ä–∞–Ω–∏—Ü–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UnaryAuthInterceptor, –∫–æ—Ç–æ—Ä—ã–π:
	‚Ä¢	–ø–∞—Ä—Å–∏—Ç JWT
	‚Ä¢	–∏–∑–≤–ª–µ–∫–∞–µ—Ç userID
	‚Ä¢	–∫–ª–∞–¥—ë—Ç –µ–≥–æ –≤ context.Context

ctx = WithUserID(ctx, userID)

	3.	–î–∞–ª–µ–µ:

	‚Ä¢	context.Context –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Å–∫–≤–æ–∑—å –≤—Å–µ —Å–ª–æ–∏
	‚Ä¢	service –∏ repository –Ω–µ –∑–Ω–∞—é—Ç –ø—Ä–æ JWT
	‚Ä¢	–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∞–∫:

userID, ok := auth.UserIDFromContext(ctx)

üëâ –¢–æ–∫–µ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤–Ω—É—Ç—Ä–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–∏—Å—Ç—ã–π context.

‚∏ª

üì° API

HTTP (REST)

–ú–µ—Ç–æ–¥	–ü—É—Ç—å	–û–ø–∏—Å–∞–Ω–∏–µ
GET	/health	Health check
POST	/register	–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
POST	/login	–õ–æ–≥–∏–Ω
GET	/todos	–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
POST	/todos	–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
PATCH	/todos/{id}	–û–±–Ω–æ–≤–∏—Ç—å completed
DELETE	/todos/{id}	–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É


‚∏ª

gRPC

TodoService
	‚Ä¢	CreateTodo
	‚Ä¢	ListTodos

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
	‚Ä¢	user_id –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ request
	‚Ä¢	identity –±–µ—Ä—ë—Ç—Å—è –∏–∑ context.Context
	‚Ä¢	–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è auth interceptor
	‚Ä¢	–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è deadlines –∏ metadata

‚∏ª

üåê Outbound –≤—ã–∑–æ–≤—ã

HTTP

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:

https://picsum.photos/200/300

gRPC

–í–Ω–µ—à–Ω–∏–π gRPC-—Å–µ—Ä–≤–µ—Ä:

grpc.postman-echo.com

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:
	‚Ä¢	outbound gRPC-–≤—ã–∑–æ–≤–æ–≤
	‚Ä¢	–ø–µ—Ä–µ–¥–∞—á–∏ metadata
	‚Ä¢	—Ä–∞–±–æ—Ç—ã —Å deadline –∏ cancellation
	‚Ä¢	–ø—Ä–æ–±—Ä–æ—Å–∞ context

‚∏ª

üß™ Unit-—Ç–µ—Å—Ç—ã

–ü–æ–∫—Ä—ã—Ç service layer unit-—Ç–µ—Å—Ç–∞–º–∏ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
	‚Ä¢	PostgreSQL
	‚Ä¢	HTTP
	‚Ä¢	gRPC
	‚Ä¢	Docker

–ü–æ–¥—Ö–æ–¥
	‚Ä¢	–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fakeRepo, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
	‚Ä¢	—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π service
	‚Ä¢	–ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è:
	‚Ä¢	–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
	‚Ä¢	–≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
	‚Ä¢	–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ü—Ä–∏–º–µ—Ä

func TestService_DeleteTodo_Success(t *testing.T) {
	repo := &fakeRepo{deleteResult: true}
	service := New(repo, nil)

	ok, err := service.DeleteTodo(ctx, 42)
}

–ß—Ç–æ –¥–∞—é—Ç —Ç–µ—Å—Ç—ã
	‚Ä¢	–≥–∞—Ä–∞–Ω—Ç–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
	‚Ä¢	–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
	‚Ä¢	–±—ã—Å—Ç—Ä—ã–π feedback –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

‚∏ª

üõ† Makefile –∏ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Makefile –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥.

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è gRPC-–∫–æ–¥–∞

make generate

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Go-–∫–æ–¥ –∏–∑ .proto —Ñ–∞–π–ª–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ—Ä–Ω–µ–≤–æ–≥–æ Go-–º–æ–¥—É–ª—è –ø—Ä–æ–µ–∫—Ç–∞.

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (transport-level):

make generate-postman

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ gRPC-–∫–æ–¥–∞ –Ω–∞–ø—Ä—è–º—É—é –≤ internal/transport/grpc.

‚∏ª

–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

make build
make run

–¢–µ—Å—Ç—ã

make test

Docker

make docker-build
make docker-up


‚∏ª

üê≥ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
	‚Ä¢	Docker
	‚Ä¢	Docker Compose

–ó–∞–ø—É—Å–∫

docker compose up --build

HTTP

http://localhost:8080

gRPC

localhost:50051


‚∏ª

üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

cmd/api                ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
internal/repository    ‚Äî PostgreSQL
internal/service       ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
internal/transport
  ‚îú‚îÄ‚îÄ http             ‚Äî REST handlers
  ‚îú‚îÄ‚îÄ grpc             ‚Äî gRPC server
  ‚îî‚îÄ‚îÄ grpcclient       ‚Äî outbound gRPC
internal/auth          ‚Äî JWT + context + interceptors
proto                  ‚Äî .proto —Ñ–∞–π–ª—ã


‚∏ª

üöÄ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

‚úÖ MVP –∑–∞–≤–µ—Ä—à—ë–Ω
‚úÖ HTTP –∏ gRPC —Ä–∞–±–æ—Ç–∞—é—Ç
‚úÖ Auth —á–µ—Ä–µ–∑ context
‚úÖ Unit-—Ç–µ—Å—Ç—ã service —Å–ª–æ—è
‚úÖ Docker-–æ–∫—Ä—É–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ

‚∏ª

üßæ Summary

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–ª–æ–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
Transport ‚Üí Service ‚Üí Repository
—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π HTTP –∏ gRPC, JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ context.Context –∏ unit-—Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
